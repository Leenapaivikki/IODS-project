---
title: "chapter5.Rmd"
author: "Leena Huiku"
date: "28.11.2018"
output: html_document
---

#Dimensionality reduction techniques

The exercise consists of two parts: the first part is the human data analysis based on United Nations report and the second part is the tea usage analysis based on questionnaire among 300 individuals, the data extracted from R FactoMineR library. 

A multidimensional data is challenging to visualizise, so the reduction of variables is often needed to capture the phenomenen behind the data. There are a fairly large selection of statistical methods that can be used to lower the dimensionality of data. In this exercise we use Principal component analysis (PCA) and Multiple correspondence analysis (MCA).

```{r setup5, echo=F, message=F}
# Clear memory.
rm(list = ls())
# Packages that are needed in the exercise 5
library(dplyr)
library(ggplot2)
library(GGally)
library(tidyverse)
library(corrplot)
library(FactoMineR)
```
#Human data

##Description of the data

The exercise is based on the dataset, which originates from the United Nations Development Programme. There are two data indices from United Nations Human Development Report:</br>
Human Development Index (HDI): http://hdr.undp.org/en/composite/HDI</br>
Gender Inequality Index (GII): http://hdr.undp.org/en/composite/GII</br>
The original data source: http://s3.amazonaws.com/assets.datacamp.com/production/course_2218/datasets/human1.txt</br>

The orginal dataset has been prepared to our analysis. The indices HDI and GII have been joined by variable country and two additional variables have been calculated using existing variables of the dataset. Variable GNI has been transformed to numeric and some unneeded variables have been removed. The observations with missing values and those related to regions have been removed. The data contains 155 observations and 8 variables.

The variables are

- edu2_f_m = Proportion of females with at least secondary education / Proportion of males with at least secondary education</br>
- labo_f_m = Proportion of females in the labour force / Proportion of males in the labour force</br>
- edu_exp = Expected years of education</br>
- life_exp = Life expectancy at birth</br>
- gni_cap = Gross national income per capita (2011 PPP $)</br>
- mat_mor = Maternal mortality rate (deaths per 100,000 live births)</br>
- ado_birth = Adolescent birth rate (births per 1,000 women ages 15-19)</br>
- parli_f = Percetange of female representatives in parliament (% held by women)</br>

To read the data in.
```{r data_input5}
human <- as.data.frame(read.table('data/human.csv',  sep="\t", header=TRUE))
```

Summary of data is generated by function glimpse:
```{r glimpse5}
glimpse(human)
```

To showcase a graphical overview of the data and summaries of the variables in the data, ggpairs and summary functions are carried out:
```{r graphics5}
p <- ggpairs(human, lower = list(combo = wrap("facethist", bins = 20)))
p
summary(human)
```

The distribution of most of the variables is rather biased. The exceptions are variable Expected years of education (edu_exp) and the gender ratio with at least secondary education (edu2_f_m), which are rather close to the normal distribution. The scatterplots showcase that there are outliers in plots e.g. variable gni_cap. The range of the variables varies a lot, for instance variable gni_cap from 581 to 123124 and life expantancy from 49 to 83.5.

To showcase the relationship between the variables, corrplot function is conducted:

```{r corrplot5}
cor_matrix <- cor(human) %>% round(digits = 2)
corrplot(cor_matrix, method="circle", type="upper", cl.pos = "b", tl.pos = "d", tl.cex = 0.6)
```

The correlation plot shows that some variables correlate strongly with each other. The strong negative correlation (-0.857) is between life expectancy and maternal mortality rate. The strong positive correlation is between life expectancy and education expectancy (0.789) and between adolescent birth rate and maternal mortality (0.759).

#Principal component analysis (PCA)

The target with of Principal Component Analysis (PCA) is to lower the dimensionality of the data. There are two functions in the default package distribution of R that can be used to perform PCA: princomp() and prcomp(). The prcomp() function uses the Singular Value Decomposition (SVD) method. SVD is the preferred, more numerically accurate method. Let's use the function princomp() in the next calculation on the not standarized dataset.

```{r PCA_notstandardised5}
pca_human <- prcomp(human)
p_human_notstd <- summary(pca_human)
p_human_notstd
```

The summary above showcases that the first principal component PC1 explains nearly all of the variance (proportion of variance 9.999e-01, PC2 0.0001). The bilpot drawing generates a list of errors related to arrows which the program cannot draw properly.

```{r biplot_notstandardised5}
biplot(pca_human, choices = 1:2, cex = c(0.8, 1), col = c("grey40", "deeppink2"))
```

PCA is sensitive to the relative scaling of the original features and assumes that features with larger variance are more important than features with smaller variance. The variable gni_cap stands out of from other variables. The gni_cap is on totally different scale than other variables and as earlier stated there are some outliers that can detected in the scatterplot. Standardization of the features before PCA is needed. After standardising the variables, the results look different:

```{r human_standardised_PCA}
# Standardisation of the variables
human_std <- scale(human) 
pca_human_std <- prcomp(human_std)
s_human_std <- summary(pca_human_std)
s_human_std
# Percentages of variance for the plot titles
pr_shs <- round(100*s_human_std$importance[2, ], digits = 1)
pc_shs_lab <- paste0(names(pr_shs), " (", pr_shs, "%)")
biplot(pca_human_std, choices = 1:2, cex = c(0.6, 1), col = c("grey40", "deeppink2"), xlab = pc_shs_lab[1], ylab = pc_shs_lab[2])
```

Based on my biplot, the relationships are not clear enough, so I generated a summary of relationship (correlation or anticorrelation, etc) between the initial variables and the principal components ($rotation):

```{r human_standardised_PCA_rotation}
pca_human_std$rotation
```

# Interpretations of the PCA results on the standardized human data

The first principal component PCA1 explains 53.6% and the second principal component PCA2 explains 16.2% the variance of the eight variables.

Based on the biplot and the summary above, it can be concluded that the first component PC1 represents the variables that are related to the living conditions and welfare and the second component PCA2 is related to equality questions. Based on graphics these issues are not correlated.   

The first component represents variables maternal mortality (mat_mor) and the adolescent birth rate (ado_birth), which are positively correlated. The data indicates that maternal mortality rate is high in the teenage pregnancies and the living conditions explain the phenomena.

Other variables that are related to the first component and correlate positively with each other are expected level of education (edu_exp), the ratio of percentages of females vs. males with secondary education (edu2_f_m ), life expectancy at birth (life_exp) and gross national income per capita (gni_cap).

The second component PCA2 is related to the equality issues. The biplot showcases strong postitive correlation between the variables ratio of females vs. males in the labour force (labo_f_m) and the percetange of female representatives in parliament (parli_f).

Let's take some examples of the data. Based on the data and the biplot above, the rate of maternal mortality and teenage pregnancies are high in Mosambique. On the other hand, the women in Mosambique are active in politics and the ratio female vs. male in the labour market shows that women participate actively in the labour market.

In Qatar, there are more women with at least secondary education than men, the life expentancy rate is high, and gross national income is high, but there are no women in the parliament.

The examples indicate that the components PCA1 and PCA2 are not correlated as was stated based on the biplot. As whole, the living conditions explain the most variability of the data.

#Multiple Correspondence Analysis (MCA) on the tea data 

The tea data analysis is based on questionnaire data on tea usage among 300 individuals, extracted from R FactoMineR library. The description of the questionnaire in the library: The data used here concern a questionnaire on tea. We asked to 300 individuals how they drink tea (18 questions), what are their product's perception (12 questions) and some personal details (4 questions). The first 18 questions are active ones, the 19th is a supplementary quantitative variable (the age) and the last variables are supplementary categorical variables.

To load the data:

```{r tea_data5b}
library(FactoMineR)
data(tea)
```

Let's have a look on the data by using glimpse function:

```{r tea_glimpse5b}
glimpse(tea)
```


All variables are of categorial type. To showcase a graphical overview of the data and of the variables in the data, I tried to use "ggpairs" fundtion but the program was not able to carry out the task. Therefore I create a new dataset called tea2 and choose variables that could explain the usage of tea: Where do the people buy tea, do they use teabags and other aspects of the tea usage.


```{r variables5b}
keep2 <- c("age_Q", "where", "SPC", "price", "how", "tearoom")
tea2 <- dplyr::select(tea, one_of(keep2))
gather(tea2) %>% ggplot(aes(value)) + 
facet_wrap("key", scales = "free") + 
geom_bar() + 
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
```

Let's carry out an MCA for the data and summarise the model:

```{r tea2_MCA}
mca <- MCA(tea2)
# summary of the model
summary(mca)
```

The summary showcases that the dimensions don't explain a large proportion of the total variance. There are no strong relations between the dimensions and the variables. The situation by the plot:
	
```{r tea2_plot}
# visualize MCA
plot(mca, invisible=c("ind"), habillage = "quali")
```

The plot showcases the variables <i>where</i> and <i>how</i> are related to the DIM1. The both variables are related to DIM2 too. Several other variables are related to both dimensions.

Based on the plot, we can assume that there are persons who tend to buy unpackaged tea in the specialized tea shops and those who buy tea bags at the chain stores. The analysis demonstrates that there is no clear overall pattern of the tea usage in this data.
